<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo Familiar</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#2ecc71">
    <link rel="apple-touch-icon" href="/icon-192.png">
    <!-- Estilos base -->
    <link rel="stylesheet" href="style.css">
    <!-- Temas Modulares -->
    <link rel="stylesheet" href="login-theme.css">
    <link rel="stylesheet" href="lobby-theme.css">
    <link rel="stylesheet" href="game-theme.css">
    <link rel="stylesheet" href="host-theme.css">
    <link rel="stylesheet" href="modal-theme.css">
    <link rel="stylesheet" href="chat-theme.css">
    <link rel="stylesheet" href="card-manager-theme.css">
</head>

<body class="fondo-juego">

    <div class="app-container">

        <!-- PANTALLA 1: BIENVENIDA -->
        <section id="pantalla-bienvenida" class="pantalla activa pantalla-login-moderna">

            <button id="btnLogout" class="btn-logout oculto" title="Cerrar Sesi√≥n">
                Salirüî¥ </button>

            <div class="logo-container">
                <svg class="logo-img" width="300" height="130" viewBox="0 0 300 130" xmlns="http://www.w3.org/2000/svg">
                    <filter id="sombraTexto" x="-20%" y="-20%" width="140%" height="140%">
                        <feDropShadow dx="2" dy="3" stdDeviation="2" flood-color="rgba(0,0,0,0.2)" />
                    </filter>
                    <path d="M150 15 L165 45 L185 25 L175 65 L125 65 L115 25 L135 45 Z" fill="#f1c40f" stroke="white"
                        stroke-width="2" style="filter: url(#sombraTexto);" />
                    <text x="50%" y="80" text-anchor="middle" font-family="Arial, sans-serif" font-weight="900"
                        font-size="65" fill="white" style="filter: url(#sombraTexto); letter-spacing: 2px;">
                        BINGO
                    </text>
                    <text x="50%" y="115" text-anchor="middle" font-family="Arial, sans-serif" font-weight="bold"
                        font-size="22" fill="white" style="opacity: 0.9; letter-spacing: 6px;">
                        FAMILIAR
                    </text>
                </svg>
            </div>

            <div class="contenedor-control-login">

                <div id="tabsContainer" class="tabs-container">
                    <button id="tabInvitado" class="tab-btn activo">Invitado</button>
                    <button id="tabUsuario" class="tab-btn">Usuario</button>
                </div>

                <div id="mensajeBienvenida" class="mensaje-bienvenida oculto">
                    <h3 id="bienvenidaNombre"></h3>
                </div>

                <div id="formInvitado" class="login-form">
                    <input type="text" id="inputNombre" placeholder="Ingresa tu Nombre" maxlength="15"
                        autocomplete="off">
                    <p id="errorFlotanteInvitado" class="error-flotante"></p>
                </div>

                <div id="formUsuario" class="login-form oculto">
                    <input type="text" id="inputUsuario" placeholder="Usuario">
                    <input type="password" id="inputContrasena" placeholder="Contrase√±a">

                    <p id="errorFlotanteUsuario" class="error-flotante"></p>

                    <button id="btnLoginUsuario" class="btn-inicio btn-blanco">Iniciar Sesi√≥n</button>
                </div>
            </div>

            <div id="contenedorUnirse" style="width: 100%; max-width: 300px;">
                <input type="text" id="inputClave" placeholder="C√≥digo de Sala" maxlength="4" autocomplete="off"
                    style="text-transform:uppercase; margin-bottom: 10px;">

                <button id="btnUnirsePartida" class="btn-inicio btn-borde">Unirse a la Partida</button>
            </div>


            <div class="separador-sutil"></div>
            <div class="divider-text">O</div>
            <button id="btnCrearPartida" class="btn-inicio btn-blanco">üëë Crear Nueva Partida</button>


            <button id="btnConexionFavorito" class="btn-inicio btn-borde"
                style="margin-top: 15px; font-size: 14px; padding: 10px; opacity:0.7;">
                üîÑ Intentar Reconexi√≥n
            </button>

            <div
                style="position: absolute; bottom: 25px; font-size: 14px; opacity: 0.8; color: white; letter-spacing: 1px;">
                Creado por <strong>Alex Abensur</strong>
            </div>

        </section>

        <!-- PANTALLA 2: LOBBY (REDISE√ëADO) -->
        <section id="pantalla-lobby" class="pantalla pantalla-lobby-moderna">

            <button id="btnSalirLobby"
                style="position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2); border: none; color: white; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-weight: bold; z-index: 10; display: flex; justify-content: center; align-items: center; padding: 0; line-height: 1;">‚úï</button>

            <h2>Sala de Espera</h2>

            <div class="caja-clave">
                <p>C√ìDIGO DE PARTIDA</p>
                <strong id="lobbyClave" class="clave-gigante">---</strong>
            </div>

            <div id="lobby-vista-anfitrion"
                style="width: 100%; display: flex; flex-direction: column; align-items: center;">

                <div class="patron-selector-container">
                    <label class="label-selector">Modalidad de Juego:</label>

                    <div class="custom-select-wrapper">
                        <div class="custom-select" id="dropdownPatrones">

                            <div class="select-trigger">
                                <span id="textoPatronSeleccionado">L√≠nea Simple (Cualquiera)</span>
                                <span class="arrow">‚ñº</span>
                            </div>

                            <div class="custom-options">
                                <span class="option selected" data-value="linea">L√≠nea Simple (Cualquiera)</span>
                                <span class="option" data-value="carton_lleno">Cart√≥n Lleno (Apag√≥n)</span>
                                <span class="option" data-value="cuadrado">Cuadrado (Marco)</span>

                                <span class="option" data-value="letra_l">Letra L</span>
                                <span class="option" data-value="l_invertida">L Invertida</span>
                                <span class="option" data-value="letra_x">Letra X (Aspa)</span>
                                <span class="option" data-value="cruz_mas">Cruz (+)</span>

                                <span class="option" data-value="diagonal_backslash">Diagonal (\)</span>
                                <span class="option" data-value="diagonal_slash">Diagonal Invertida (/)</span>

                                <span class="option" data-value="columna_b">Columna B</span>
                                <span class="option" data-value="columna_i">Columna I</span>
                                <span class="option" data-value="columna_n">Columna N</span>
                                <span class="option" data-value="columna_g">Columna G</span>
                                <span class="option" data-value="columna_o">Columna O</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="apuesta-container">
                    <span class="label-apuesta">APUESTA S/.</span>
                    <input type="number" id="inputMontoApuesta" class="input-apuesta" value="1.00" step="0.50" min="0">
                </div>

                <div style="width: 100%; max-width: 300px; margin: 0 auto; text-align: center;">
                    <button id="btnCambiarCartonHost" class="btn-borde"
                        style="border-color: rgba(255,255,255,0.5); font-size: 14px; padding: 10px 20px; width: 100%; margin-bottom: 15px;">
                        üîÑ Cambiar mi Cart√≥n
                    </button>
                    <button id="btnCargarCartonHost" class="btn-cargar-carton">
                        üìÇ Cargar Cart√≥n
                    </button>
                </div>

                <button id="btnEmpezarPartida">¬°COMENZAR JUEGO!</button>
            </div>

            <div id="lobby-vista-jugador" style="width: 100%; text-align: center;">
                <p>Esperando al anfitri√≥n... <br> ¬°Prepara tus cartones!</p>

                <div style="width: 100%; max-width: 300px; margin: 0 auto;">
                    <button id="btnCambiarCarton" class="btn-borde"
                        style="border-color: rgba(255,255,255,0.5); font-size: 14px; padding: 10px 20px; width: 100%; margin-bottom: 15px;">
                        üîÑ Cambiar mi Cart√≥n
                    </button>
                    <div id="mensajeCambioCarton"
                        style="font-size: 12px; color: #f1c40f; margin-top: -5px; min-height: 20px; text-align: center;">
                    </div>

                    <button id="btnCargarCartonJugador" class="btn-cargar-carton">
                        üìÇ Cargar Cart√≥n
                    </button>
                </div>
            </div>

            <div class="lista-jugadores-container">
                <h3>RANKING DE SESI√ìN</h3>

                <div class="ranking-header">
                    <div>#</div>
                    <div style="text-align: left;">Jugador</div>
                    <div style="text-align: center;">üèÜ</div>
                    <div style="text-align: right;">S/.</div>
                </div>

                <div id="lobbyListaJugadores">
                </div>
            </div>

            <div class="chat-contenedor">
                <div id="chatLogLobby" class="chat-log" style="height: 200px;"></div>
                <div class="chat-input-area">
                    <input type="text" id="chatInputLobby" placeholder="Escribe un mensaje...">
                    <button id="btnMicLobby" class="btn-mic" title="Audio">
                        <svg viewBox="0 0 24 24" fill="white" width="20px" height="20px">
                            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z" />
                            <path
                                d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" />
                        </svg>
                    </button>
                    <button id="btnEnviarLobby" class="btn-chat-enviar">Enviar</button>
                </div>
            </div>
        </section>

        <!-- PANTALLA 3: ANFITRI√ìN -->
        <section id="pantalla-juego-anfitrion" class="pantalla" style="padding:0;">

            <div class="header-jugador header-anfitrion-estilo">
                <div class="perfil-usuario">
                    <div class="avatar-img anfitrion-avatar"></div>
                    <div class="datos-usuario">
                        <span class="nombre-usuario" id="nombreAnfitrionDisplay">Anfitri√≥n</span>
                        <span class="puntos-usuario">Anfitri√≥n</span>
                    </div>
                    <div class="contenedor-saldo-badge">
                        <span id="displaySaldoAnfitrion" class="badge-saldo">S/. 0.00</span>
                    </div>
                </div>

                <div class="header-derecha">
                    <div class="codigo-sala-badge" title="C√≥digo de Sala">
                        üîë <span id="displayClaveAnfitrion">---</span>
                    </div>

                    <button id="btnAjustesAnfitrion" class="btn-ajustes">‚öôÔ∏è
                        <div id="menuAjustesAnfitrion" class="ajustes-menu">
                            <div class="ajuste-item">üé® Color Mesa <input type="color" id="inputColorTemaAnfitrion"
                                    value="#2ecc71"></div>

                            <div class="ajuste-item">
                                <span>üó£Ô∏è Voz Narrador</span>
                                <label class="switch-label">
                                    <input type="checkbox" id="checkVozAnfitrion" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="ajuste-item">
                                <span>üéµ Efectos Sonido</span>
                                <label class="switch-label">
                                    <input type="checkbox" id="checkEfectosAnfitrion" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="ajuste-item">
                                <span>üìª Auto-Audio Chat</span>
                                <label class="switch-label">
                                    <input type="checkbox" id="checkAutoPlayAnfitrion" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="ajuste-item">
                                <span>‚≠ê Guardar Favorito</span>
                                <label class="switch-label">
                                    <input type="checkbox" id="checkGuardarFavoritoHost">
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="ajuste-item" id="btnSalirPartidaHost"
                                style="cursor:pointer; color: #e74c3c; font-weight: 900; margin-top: 10px; border-top: 1px solid #eee; padding-top: 10px;">
                                üö™ Cerrar Sala (Terminar)
                            </div>
                        </div>
                    </button>
                </div>
            </div>

            <div class="area-sorteo-anfitrion">
                <div class="contenedor-bolas-grandes">
                    <div class="bola-wrapper"><span class="label-bola">ANTERIOR</span>
                        <div id="fichaAnterior" class="bolilla-mediana">--</div>
                    </div>
                    <div class="bola-wrapper"><span class="label-bola">ACTUAL</span>
                        <div id="fichaActual" class="bolilla-gigante">--</div>
                    </div>
                </div>
                <button id="btnSortearFicha" class="btn-sortear">SACAR BOLILLA</button>

                <div class="controles-top-anfitrion">
                    <label class="switch-label"><input type="checkbox" id="checkAutomatico"> <span
                            class="slider"></span></label>
                    <span style="color:white; font-weight:bold; font-size:14px;">Auto</span>
                    <input type="number" id="inputIntervalo" class="input-mini" min="3" max="30" value="7"> <span
                        style="color:white; font-size:12px; margin-right:5px;">seg</span>
                </div>
            </div>

            <div class="panel-cartilla-host" id="panelCartillaHost">
                <div class="toggle-cartilla-host" id="btnToggleCartillaHost">
                    üëá Jugar tambi√©n (Mi Cart√≥n) <span class="icono-toggle">‚ñº</span>
                </div>
                <div class="contenido-cartilla-host">
                    <div style="text-align:center; color:white; margin-bottom:10px; margin-top:10px; font-size:12px;">
                        <span id="hostPatronTexto">---</span>
                    </div>
                    <div id="cartillaHostContainer"></div>
                    <button id="btnCantarBingoHost" class="btn-bingo-3d"
                        style="margin: 10px 0; font-size:16px; padding:10px;">¬°CANTAR BINGO!</button>
                    <div class="chat-contenedor">
                        <div id="chatLogHost" class="chat-log" style="height: 200px;"></div>
                        <div class="chat-input-area">
                            <input type="text" id="chatInputHost" placeholder="Escribe un mensaje...">
                            <button id="btnMicHost" class="btn-mic" title="Audio">
                                <svg viewBox="0 0 24 24" fill="white" width="20px" height="20px">
                                    <path
                                        d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z" />
                                    <path
                                        d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" />
                                </svg>
                            </button>
                            <button id="btnEnviarHost" class="btn-chat-enviar">Enviar</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="contenedor-tablero-control">
                <div class="header-tablero-control">
                    <div class="col-header bg-b">B</div>
                    <div class="col-header bg-i">I</div>
                    <div class="col-header bg-n">N</div>
                    <div class="col-header bg-g">G</div>
                    <div class="col-header bg-o">O</div>
                </div>
                <div id="grid75" class="grid-75"></div>
            </div>
        </section>

        <!-- PANTALLA 4: JUGADOR -->
        <section id="pantalla-juego-jugador" class="pantalla" style="padding:0;">
            <div class="header-jugador">
                <div class="perfil-usuario">
                    <div class="avatar-img"></div>
                    <div class="datos-usuario">
                        <span class="nombre-usuario" id="nombreJugadorDisplay">Jugador</span>
                        <span class="puntos-usuario">Jugador</span>
                    </div>
                    <div class="contenedor-saldo-badge">
                        <span id="displaySaldoJugador" class="badge-saldo">S/. 0.00</span>
                    </div>
                </div>
                <div class="header-derecha">
                    <div class="codigo-sala-badge" title="C√≥digo de Sala">
                        üîë <span id="displayClaveJugador">---</span>
                    </div>
                    <button id="btnAjustes" class="btn-ajustes">‚öôÔ∏è
                        <div id="menuAjustes" class="ajustes-menu">
                            <div class="ajuste-item">üé® Color Mesa <input type="color" id="inputColorTema"
                                    value="#2ecc71"></div>

                            <div class="ajuste-item">
                                <span>üó£Ô∏è Voz Narrador</span>
                                <label class="switch-label">
                                    <input type="checkbox" id="checkVozJugador" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="ajuste-item">
                                <span>üéµ Efectos Sonido</span>
                                <label class="switch-label">
                                    <input type="checkbox" id="checkEfectosJugador" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="ajuste-item">
                                <span>üìª Auto-Audio Chat</span>
                                <label class="switch-label">
                                    <input type="checkbox" id="checkAutoPlayJugador" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>



                            <div class="ajuste-item">
                                <span>‚≠ê Cart√≥n Favorito</span>
                                <label class="switch-label">
                                    <input type="checkbox" id="checkGuardarFavorito">
                                    <span class="slider"></span>
                                </label>
                            </div>


                            <div class="ajuste-item" id="btnSalirPartidaJugador"
                                style="cursor:pointer; color: #e74c3c; font-weight: 900;">
                                üö™ Salir de la Partida
                            </div>
                        </div>
                    </button>
                </div>
            </div>
            <div id="historialContenedor" class="historial-bolillas"><span style="color: white;">Esperando
                    bolillas...</span></div>
            <div style="text-align:center; color:white; font-weight:bold; margin-bottom:5px;">
                Jugando por: <span id="jugadorPatron">---</span>
            </div>
            <div id="cartillaJugador"></div>
            <button id="btnCantarBingo" class="btn-bingo-3d">¬°CANTAR BINGO!</button>
            <div class="chat-contenedor">
                <div id="chatLogJugador" class="chat-log" style="height: 200px;"></div>
                <div class="chat-input-area">
                    <input type="text" id="chatInputJugador" placeholder="Escribe un mensaje...">
                    <button id="btnMicJugador" class="btn-mic" title="Audio">
                        <svg viewBox="0 0 24 24" fill="white" width="20px" height="20px">
                            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z" />
                            <path
                                d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" />
                        </svg>
                    </button>
                    <button id="btnEnviarJugador" class="btn-chat-enviar">Enviar</button>
                </div>
            </div>
        </section>

    </div>

    <!-- SCRIPTS -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="game-ui.js"></script>
    <script src="host-ui.js"></script>
    <script src="audio-engine.js"></script>
    <script src="card-manager-logic.js"></script>
    <script src="client.js" defer></script>

    <!-- MODAL FIN (REDISE√ëADO CON ESTILO CELEBRACI√ìN) -->
    <div id="modalFinJuego" class="modal-overlay">
        <div class="modal-card">
            <div class="icono-trofeo">üèÜ</div>
            <h2 class="modal-titulo">¬°BINGO!</h2>
            <p class="modal-subtitulo">El ganador es:</p>

            <div id="contenedorListaGanadores" class="lista-ganadores-scroll">
            </div>

            <div id="contenedorCartillaGanadora" class="cartilla-ganadora-container oculto">
            </div>
            <button id="btnNuevaRondaHost" class="btn-modal"
                style="background-color: #f1c40f; color: #2d3436; margin-bottom: 15px; display: none; box-shadow: 0 10px 20px rgba(241, 196, 15, 0.4);">
                üëë Nueva Ronda (Todos)
            </button>

            <button id="btnVolverAlLobby" class="btn-modal">Volver al Lobby</button>
        </div>
    </div>


    <div id="modalGestorCartones" class="modal-overlay">
        <div class="modal-contenido" style="max-width: 600px; width: 95%;">
            <h2>üìÇ Mis Cartones</h2>
            <p style="font-size: 14px; color: #666; margin-bottom: 10px;">Selecciona un cart√≥n para usarlo
                permanentemente.</p>

            <div id="gridCartonesGuardados" class="grid-cartones-guardados">
            </div>

            <button id="btnCerrarGestor" class="btn-modal"
                style="margin-top: 20px; background: #95a5a6;">Cerrar</button>
        </div>
    </div>


    <div id="avisoCuentaRegresiva">¬°√öLTIMA OPORTUNIDAD! <span id="segundosRestantes">10</span>s</div>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(reg => console.log('PWA lista:', reg.scope))
                    .catch(err => console.log('Error PWA:', err));
            });
        }
    </script>

</body>

</html>